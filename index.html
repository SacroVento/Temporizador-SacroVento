<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporizador de Meditaci√≥n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable"></script>
</head>
<body class="bg-gray-900 text-white">
    <div class="max-w-3xl mx-auto py-10 px-5">
        <!-- Imagen de la formaci√≥n -->
        <img src="FOTO TEMPORIZADOR MEDITACION NO DUAL.png" alt="Meditaci√≥n No Dual" class="mx-auto w-7/10 mb-5">

        <!-- Temporizador -->
        <div class="text-center">
            <h1 class="text-2xl font-bold mb-3">Elige el tiempo de meditaci√≥n por fase:</h1>
            <input id="timeInput" type="number" min="1" max="60" value="15" class="text-black w-20 p-2 text-center rounded">
            <p class="mt-2">Duraci√≥n total: <span id="totalTime">60</span> minutos</p>

            <div id="timerDisplay" class="text-4xl font-bold my-10">00:00</div>
            <p id="phaseDisplay" class="text-lg font-semibold">Fase 1 de 4</p>

            <!-- Botones de control -->
            <div class="flex justify-center space-x-3 mt-5">
                <button id="startButton" class="px-5 py-2 rounded bg-[#D4AF37] hover:bg-[#C69E33]">Iniciar</button>
                <button id="pauseButton" class="px-5 py-2 rounded bg-blue-800">Pausar</button>
                <button id="resumeButton" class="px-5 py-2 rounded bg-blue-800">Reiniciar Meditaci√≥n</button>
                <button id="resetButton" class="px-5 py-2 rounded bg-gray-600">Reiniciar</button>
            </div>

            <!-- Mensaje motivacional -->
            <div id="motivationalMessage" class="mt-5 text-center text-lg font-bold hidden bg-[#D4AF37] text-black p-3 rounded"></div>
        </div>

        <!-- Espacio para registrar la experiencia -->
        <div class="mt-10">
            <textarea id="experienceInput" placeholder="Escribe tu experiencia..." class="w-full h-32 p-2 text-black rounded"></textarea>
            <button id="saveButton" class="px-5 py-2 mt-2 rounded bg-[#D4AF37]">Guardar</button>
        </div>

        <!-- Tabla de registro -->
        <div class="mt-10">
            <h2 class="text-xl font-semibold mb-3">Registro de Meditaciones</h2>
            <table id="meditationTable" class="w-full text-left table-auto border-collapse border border-gray-700">
                <thead>
                    <tr>
                        <th class="border border-gray-700 px-2 py-1">Fecha</th>
                        <th class="border border-gray-700 px-2 py-1">Hora</th>
                        <th class="border border-gray-700 px-2 py-1">Tiempo por Fase</th>
                        <th class="border border-gray-700 px-2 py-1">Tiempo Total</th>
                        <th class="border border-gray-700 px-2 py-1">Experiencia</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button id="generatePdfButton" class="px-5 py-2 mt-2 rounded bg-[#D4AF37]">Generar PDF</button>
            <button id="clearHistoryButton" class="px-5 py-2 mt-2 rounded bg-gray-600">Borrar Historial</button>
        </div>
    </div>

    <script>
        // Variables globales
        let timerWorker;
        let timerData = {
            timePerPhase: 15, // minutos
            totalPhases: 4,
            currentPhase: 1,
            remainingTime: 15 * 60, // segundos
            isPaused: false
        };

        const motivationalMessages = [
            "¬°Qu√© bien lo has hecho! üåü Sigue adelante, ¬°la pr√°ctica hace al maestro! üßò",
            "Eres un ser de luz radiante. ‚ú® Encuentra gratitud en este momento. üôè",
            "La paz interior es tuya. üïäÔ∏è Cada respiraci√≥n cuenta. üå¨Ô∏è",
            "¬°Maravillosa meditaci√≥n! üå∏ Sigue cultivando tu bienestar. üåø",
            "Tu constancia inspira. üåû Hoy es un gran d√≠a para la calma. üí´",
            "Contin√∫a explorando tu ser. üåé Cada paso te acerca m√°s a la paz interior. ‚ù§Ô∏è",
            "Tu energ√≠a se renueva. üîÜ Este momento es todo tuyo. üï∞Ô∏è",
            "Eres fuerte y sereno. üí™ Tu paz beneficia a todos. üåä",
            "Disfruta la tranquilidad alcanzada. üòå Sigue floreciendo. üå∑",
            "Meditaci√≥n completada con √©xito. üéâ ¬°Gran trabajo! üèÜ",
            "Encuentra alegr√≠a en la calma. üòä Hoy sembraste calma. üå±",
            "La pr√°ctica diaria transforma. üíñ Sigue dedic√°ndote con amor. üïäÔ∏è",
            "Cada instante cuenta. üï∞Ô∏è Tu progreso es notable. üåü",
            "Has dado un paso m√°s hacia la paz interior. ‚ú® Bravo. üôå",
            "El camino es el objetivo. üö∂‚Äç‚ôÇÔ∏è Sigue cultivando la calma. üå≥",
            "Has creado un oasis de tranquilidad. üèùÔ∏è Sigue practicando. üíé",
            "Respira profundo. üå¨Ô∏è Tu constancia ilumina tu ser. üåû",
            "Qu√© momento de serenidad. üåä Gracias por tu dedicaci√≥n. ‚ù§Ô∏è",
            "Un instante perfecto para agradecer. üôè Cada d√≠a mejora. üåÖ",
            "¬°Bien hecho! üåü Tu pr√°ctica beneficia a todos. üåç",
            "Eres un ejemplo de disciplina. üéØ Sigue as√≠. üïäÔ∏è",
            "La calma interior es tu mejor aliado. üåø Practica siempre. üåü",
            "Sigue buscando dentro de ti. üîç Hoy has encontrado paz. üåº",
            "Qu√© regalo te has dado. üéÅ Contin√∫a cuidando de ti. ‚ù§Ô∏è",
            "Tu compromiso es inspirador. üåü Sigue adelante. üå∏",
            "Eres capaz de todo. üåü Tu progreso es evidente. üíñ",
            "Has alcanzado un estado de calma profundo. üïäÔ∏è Bravo. üôå",
            "Qu√© momento tan significativo. ‚ú® Agradece siempre. üôè",
            "Tu pr√°ctica ilumina el mundo. üåû Sigue brillando. üåü",
            "Cada meditaci√≥n es un paso m√°s. üåä Gracias por tu esfuerzo. ‚ù§Ô∏è"
        ];

        const timeInput = document.getElementById('timeInput');
        const totalTimeDisplay = document.getElementById('totalTime');
        const timerDisplay = document.getElementById('timerDisplay');
        const phaseDisplay = document.getElementById('phaseDisplay');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const resumeButton = document.getElementById('resumeButton');
        const resetButton = document.getElementById('resetButton');

        const motivationalMessage = document.getElementById('motivationalMessage');

        // Archivos de sonido
        const phaseSound = new Audio('Sonido entre Fases.mp3');

        // Actualiza el tiempo total basado en el input
        timeInput.addEventListener('input', () => {
            timerData.timePerPhase = parseInt(timeInput.value, 10);
            timerData.remainingTime = timerData.timePerPhase * 60;
            totalTimeDisplay.textContent = timerData.timePerPhase * timerData.totalPhases;
            resetTimer();
        });

        // Formatea el tiempo en mm:ss
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Configura el Web Worker
        function setupWorker() {
            if (window.Worker) {
                if (timerWorker) timerWorker.terminate();
                timerWorker = new Worker(URL.createObjectURL(new Blob([`
                    let interval;
                    self.onmessage = function(e) {
                        const data = e.data;
                        if (data.command === 'start') {
                            if (interval) clearInterval(interval);
                            let { remainingTime, timePerPhase, totalPhases, currentPhase } = data.timerData;
                            interval = setInterval(() => {
                                remainingTime--;
                                self.postMessage({ remainingTime, currentPhase });

                                if (remainingTime <= 0) {
                                    currentPhase++;
                                    if (currentPhase > totalPhases) {
                                        clearInterval(interval);
                                        self.postMessage({ command: 'done' });
                                    } else {
                                        remainingTime = timePerPhase * 60;
                                        self.postMessage({ remainingTime, currentPhase });
                                    }
                                }
                            }, 1000);
                        } else if (data.command === 'stop') {
                            clearInterval(interval);
                        }
                    };
                `])));

                timerWorker.onmessage = function(e) {
                    const data = e.data;
                    if (data.command === 'done') {
                        displayMotivationalMessage();
                    } else {
                        timerData.remainingTime = data.remainingTime;
                        timerData.currentPhase = data.currentPhase;
                        timerDisplay.textContent = formatTime(data.remainingTime);
                        phaseDisplay.textContent = `Fase ${data.currentPhase} de ${timerData.totalPhases}`;
                    }
                };
            }
        }

        // Inicia la meditaci√≥n
        startButton.addEventListener('click', () => {
            phaseSound.play();
            setupWorker();
            timerWorker.postMessage({
                command: 'start',
                timerData
            });
        });

        // Pausa la meditaci√≥n
        pauseButton.addEventListener('click', () => {
            if (timerWorker) timerWorker.postMessage({ command: 'stop' });
        });

        // Reinicia la meditaci√≥n desde donde qued√≥
        resumeButton.addEventListener('click', () => {
            timerWorker.postMessage({
                command: 'start',
                timerData
            });
        });

        // Reinicia todo
        resetButton.addEventListener('click', () => {
            if (timerWorker) timerWorker.postMessage({ command: 'stop' });
            resetTimer();
        });

        function resetTimer() {
            timerData.currentPhase = 1;
            timerData.remainingTime = timerData.timePerPhase * 60;
            timerDisplay.textContent = formatTime(timerData.remainingTime);
            phaseDisplay.textContent = `Fase ${timerData.currentPhase} de ${timerData.totalPhases}`;
        }

        // Muestra mensaje motivacional
        function displayMotivationalMessage() {
            const randomMessage = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            motivationalMessage.textContent = randomMessage;
            motivationalMessage.classList.remove('hidden');
        }

        // Inicializaci√≥n
        resetTimer();
    </script>
</body>
</html>
